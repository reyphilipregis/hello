name: Laravel Tests

on:
  push:
    branches:
      - master  # Adjust this branch name to match your default branch

jobs:
  laravel_tests:
    runs-on: ubuntu-latest  # You can choose a different runner if needed

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.1  # Adjust the PHP version as needed

      - name: Install Composer Dependencies
        run: composer install --prefer-dist --no-progress --no-suggest

      - name: Copy .env
        run: cp .env.example .env

      - name: Generate Application Key
        run: php artisan key:generate

      - name: Run PHPUnit Tests
        run: vendor/bin/phpunit

      - name: PHPStan Analysis
        run: vendor/bin/phpstan analyze app tests

      - name: Psalm Analysis
        run: vendor/bin/psalm

      - name: Upload Test Results
        if: always()
        uses: actions/upload-artifact@v2
        with:
          name: test-results
          path: tests/_output  # Adjust this path to your test results directory
